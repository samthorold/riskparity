
<!-- README.md is generated from README.Rmd. Please edit that file -->

# riskparity

<!-- badges: start -->
<!-- badges: end -->

The goal of `{{riskparity}}` is to demonstrate different approaches to
asset allocation to achieve risk parity.

## Installation

You can install the released version of riskparity from
[CRAN](https://CRAN.R-project.org) with:

``` r
install.packages("riskparity")
```

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("samthorold/riskparity")
```

## Example

``` r
library(riskparity)
# asset allocation
w <- c(.55, .25, .2)
# asset standard deviations
s <- c(.24, .18, .15)
# asset correlation
C <- matrix(c(1, 0.85, 0.3, 0.85, 1, -0.15, 0.3, -0.15, 1), nrow = 3)

# total contribution to portfolio standard deviation
asset_stdev_contrib(w, s, C)
#> [1] 0.13141350 0.03816440 0.01047209

# marginal contribution to portfolio standard deviation
asset_stdev_contrib(w, s, C, marginal = TRUE)
#> [1] 0.23893364 0.15265760 0.05236046

# dispersion measures
effective_constituents(w)
#> [1] 2.469136
entropy(w)
#> [1] 2.710875
entropy(asset_stdev_contrib(w, s, C))
#> [1] 1.551269

df <- read.csv("../data/equity.csv")[,-1]
head(df)
#>           MSFT        AMZN          JPM            T          MMM           BA
#> 1 -0.014407566 -0.11702097 -0.036036043  0.002182840 -0.014550062 -0.011263857
#> 2 -0.002707220 -0.01204856 -0.010680363  0.002179018 -0.018791510 -0.015190208
#> 3  0.034745069 -0.04268256  0.041835051  0.006521084  0.004103810  0.028277566
#> 4  0.010493371 -0.12738890 -0.034974106 -0.017278261 -0.003782436  0.025000296
#> 5  0.002076382 -0.02189782  0.016106893 -0.017582257 -0.006877535 -0.020731685
#> 6  0.018653196  0.07462711  0.005284319  0.017896926  0.020775565 -0.001245211
#>              F         AZO
#> 1 -0.003401009 -0.01604278
#> 2 -0.006826193  0.00000000
#> 3  0.030927617  0.01630435
#> 4 -0.006666268 -0.01069519
#> 5 -0.003355939  0.03783784
#> 6  0.006734187  0.01041667
dim(df)
#> [1] 6024    8

w <- matrix(1 / rep(ncol(df), ncol(df)))
s <- apply(df, 2, sd)

C <- cor(df)
round(C, 2)
#>      MSFT AMZN  JPM    T  MMM   BA    F  AZO
#> MSFT 1.00 0.39 0.45 0.35 0.37 0.36 0.34 0.29
#> AMZN 0.39 1.00 0.29 0.16 0.24 0.22 0.22 0.21
#> JPM  0.45 0.29 1.00 0.42 0.47 0.43 0.45 0.35
#> T    0.35 0.16 0.42 1.00 0.36 0.32 0.33 0.27
#> MMM  0.37 0.24 0.47 0.36 1.00 0.43 0.38 0.34
#> BA   0.36 0.22 0.43 0.32 0.43 1.00 0.38 0.29
#> F    0.34 0.22 0.45 0.33 0.38 0.38 1.00 0.28
#> AZO  0.29 0.21 0.35 0.27 0.34 0.29 0.28 1.00
all(round(cor_robust(C, 0), 2) == round(C, 2))
#> [1] TRUE
round(cor_robust(C, 0.55), 2)
#>      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
#> [1,] 1.00 0.57 0.49 0.47 0.27 0.48 0.34 0.30
#> [2,] 0.57 1.00 0.34 0.06 0.28 0.14 0.20 0.21
#> [3,] 0.49 0.34 1.00 0.52 0.58 0.45 0.57 0.36
#> [4,] 0.47 0.06 0.52 1.00 0.37 0.26 0.29 0.26
#> [5,] 0.27 0.28 0.58 0.37 1.00 0.47 0.35 0.34
#> [6,] 0.48 0.14 0.45 0.26 0.47 1.00 0.37 0.28
#> [7,] 0.34 0.20 0.57 0.29 0.35 0.37 1.00 0.28
#> [8,] 0.30 0.21 0.36 0.26 0.34 0.28 0.28 1.00

V <- cov(df)
round(V, 6)
#>          MSFT     AMZN      JPM        T      MMM       BA        F      AZO
#> MSFT 0.000395 0.000287 0.000219 0.000117 0.000113 0.000159 0.000177 0.000108
#> AMZN 0.000287 0.001354 0.000269 0.000099 0.000135 0.000179 0.000208 0.000147
#> JPM  0.000219 0.000269 0.000614 0.000175 0.000178 0.000235 0.000289 0.000160
#> T    0.000117 0.000099 0.000175 0.000285 0.000094 0.000120 0.000144 0.000085
#> MMM  0.000113 0.000135 0.000178 0.000094 0.000237 0.000149 0.000154 0.000097
#> BA   0.000159 0.000179 0.000235 0.000120 0.000149 0.000495 0.000219 0.000119
#> F    0.000177 0.000208 0.000289 0.000144 0.000154 0.000219 0.000680 0.000137
#> AZO  0.000108 0.000147 0.000160 0.000085 0.000097 0.000119 0.000137 0.000348
all(round(cov_robust(V, 0), 6) == round(V, 6))
#> [1] TRUE
round(cov_robust(V, 0.55), 6)
#>          [,1]     [,2]     [,3]     [,4]     [,5]     [,6]     [,7]     [,8]
#> [1,] 0.000395 0.000416 0.000241 0.000157 0.000082 0.000211 0.000175 0.000110
#> [2,] 0.000416 0.001354 0.000311 0.000040 0.000160 0.000114 0.000188 0.000143
#> [3,] 0.000241 0.000311 0.000614 0.000217 0.000220 0.000249 0.000368 0.000167
#> [4,] 0.000157 0.000040 0.000217 0.000285 0.000097 0.000097 0.000128 0.000083
#> [5,] 0.000082 0.000160 0.000220 0.000097 0.000237 0.000160 0.000142 0.000097
#> [6,] 0.000211 0.000114 0.000249 0.000097 0.000160 0.000495 0.000212 0.000117
#> [7,] 0.000175 0.000188 0.000368 0.000128 0.000142 0.000212 0.000680 0.000135
#> [8,] 0.000110 0.000143 0.000167 0.000083 0.000097 0.000117 0.000135 0.000348

q <- asset_stdev_contrib(w, s, C) / sum(asset_stdev_contrib(w, s, C))
q
#> [1] 0.11626962 0.19752061 0.15782591 0.08255504 0.08537256 0.12360956 0.14816468
#> [8] 0.08868201
encb <- entropy(q)
encb
#> [1] 7.64552

C <- cor_robust(C, 0.55)

asset_stdev_contrib(w, s, C)
#> [1] 0.001880787 0.002871362 0.002512999 0.001163804 0.001257866 0.001743879
#> [7] 0.002136757 0.001264356
sum(asset_stdev_contrib(w, s, C))
#> [1] 0.01483181

q <- asset_stdev_contrib(w, s, C) / sum(asset_stdev_contrib(w, s, C))
q
#> [1] 0.12680768 0.19359483 0.16943306 0.07846674 0.08480864 0.11757693 0.14406586
#> [8] 0.08524627
encb <- entropy(q)
encb
#> [1] 7.615705

factor_stdev_contrib(w, s, C)
#>              [,1]
#> [1,] 1.384237e-02
#> [2,] 8.008617e-04
#> [3,] 9.351303e-05
#> [4,] 1.778897e-05
#> [5,] 2.669703e-05
#> [6,] 1.265116e-05
#> [7,] 3.737406e-05
#> [8,] 5.570961e-07
sum(factor_stdev_contrib(w, s, C))
#> [1] 0.01483181

p <- factor_stdev_contrib(w, s, C) / sum(factor_stdev_contrib(w, s, C))
p
#>              [,1]
#> [1,] 0.9332891223
#> [2,] 0.0539962214
#> [3,] 0.0063048970
#> [4,] 0.0011993797
#> [5,] 0.0017999850
#> [6,] 0.0008529750
#> [7,] 0.0025198586
#> [8,] 0.0000375609
enb <- entropy(p)
enb
#> [1] 1.343013
```
