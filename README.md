
<!-- README.md is generated from README.Rmd. Please edit that file -->

# riskparity

<!-- badges: start -->
<!-- badges: end -->

The goal of `{{riskparity}}` is to demonstrate different approaches to
asset allocation to achieve risk parity.

## Installation

You can install the released version of riskparity from
[CRAN](https://CRAN.R-project.org) with:

``` r
install.packages("riskparity")
```

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("samthorold/riskparity")
```

## Example

``` r
library(riskparity)
# asset allocation
w <- c(.55, .25, .2)
# asset standard deviations
s <- c(.24, .18, .15)
# asset correlation
C <- matrix(c(1, 0.85, 0.3, 0.85, 1, -0.15, 0.3, -0.15, 1), nrow = 3)

# total contribution to portfolio standard deviation
asset_stdev_contrib(w, s, C)
#> [1] 0.13141350 0.03816440 0.01047209

# marginal contribution to portfolio standard deviation
asset_stdev_contrib(w, s, C, marginal = TRUE)
#> [1] 0.23893364 0.15265760 0.05236046

# dispersion measures
effective_constituents(w)
#> [1] 2.469136
entropy(w)
#> [1] 2.710875
entropy(asset_stdev_contrib(w, s, C))
#> [1] 1.551269

df <- read.csv("../data/equity.csv")[,-1]

head(df)
#>           MSFT        AMZN          JPM            T          MMM           BA
#> 1 -0.014407566 -0.11702097 -0.036036043  0.002182840 -0.014550062 -0.011263857
#> 2 -0.002707220 -0.01204856 -0.010680363  0.002179018 -0.018791510 -0.015190208
#> 3  0.034745069 -0.04268256  0.041835051  0.006521084  0.004103810  0.028277566
#> 4  0.010493371 -0.12738890 -0.034974106 -0.017278261 -0.003782436  0.025000296
#> 5  0.002076382 -0.02189782  0.016106893 -0.017582257 -0.006877535 -0.020731685
#> 6  0.018653196  0.07462711  0.005284319  0.017896926  0.020775565 -0.001245211
#>              F         AZO
#> 1 -0.003401009 -0.01604278
#> 2 -0.006826193  0.00000000
#> 3  0.030927617  0.01630435
#> 4 -0.006666268 -0.01069519
#> 5 -0.003355939  0.03783784
#> 6  0.006734187  0.01041667

C <- cor(df)

cor_robust(C, 0)
#>           [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]
#> [1,] 1.0000000 0.3928163 0.4453626 0.3474505 0.3696522 0.3600702 0.3417370
#> [2,] 0.3928163 1.0000000 0.2945392 0.1594825 0.2376084 0.2181374 0.2162449
#> [3,] 0.4453626 0.2945392 1.0000000 0.4169323 0.4661943 0.4269122 0.4470346
#> [4,] 0.3474505 0.1594825 0.4169323 1.0000000 0.3598935 0.3204171 0.3261075
#> [5,] 0.3696522 0.2376084 0.4661943 0.3598935 1.0000000 0.4338871 0.3836712
#> [6,] 0.3600702 0.2181374 0.4269122 0.3204171 0.4338871 1.0000000 0.3772209
#> [7,] 0.3417370 0.2162449 0.4470346 0.3261075 0.3836712 0.3772209 1.0000000
#> [8,] 0.2916931 0.2142607 0.3469378 0.2701245 0.3384676 0.2854458 0.2820531
#>           [,8]
#> [1,] 0.2916931
#> [2,] 0.2142607
#> [3,] 0.3469378
#> [4,] 0.2701245
#> [5,] 0.3384676
#> [6,] 0.2854458
#> [7,] 0.2820531
#> [8,] 1.0000000
cor_robust(C, 0.55)
#>           [,1]       [,2]      [,3]       [,4]      [,5]      [,6]      [,7]
#> [1,] 1.0000000 0.56822109 0.4885112 0.46738138 0.2666386 0.4777194 0.3369550
#> [2,] 0.5682211 1.00000000 0.3406198 0.06400039 0.2825352 0.1386562 0.1962027
#> [3,] 0.4885112 0.34061984 1.0000000 0.51824966 0.5755952 0.4511759 0.5693106
#> [4,] 0.4673814 0.06400039 0.5182497 1.00000000 0.3734853 0.2584428 0.2902524
#> [5,] 0.2666386 0.28253519 0.5755952 0.37348529 1.0000000 0.4656507 0.3521406
#> [6,] 0.4777194 0.13865621 0.4511759 0.25844283 0.4656507 1.0000000 0.3658862
#> [7,] 0.3369550 0.19620271 0.5693106 0.29025245 0.3521406 0.3658862 1.0000000
#> [8,] 0.2959622 0.20893189 0.3607661 0.26384470 0.3364438 0.2821225 0.2775334
#>           [,8]
#> [1,] 0.2959622
#> [2,] 0.2089319
#> [3,] 0.3607661
#> [4,] 0.2638447
#> [5,] 0.3364438
#> [6,] 0.2821225
#> [7,] 0.2775334
#> [8,] 1.0000000

V <- cov(df)

cov_robust(V, 0)
#>          [,1]
#> [1,] 0.013554
cov_robust(V, 0.55)
#>            [,1]
#> [1,] 0.01407888

s <- apply(df, 2, sd)
S <- diag(s)
S
#>            [,1]       [,2]       [,3]       [,4]       [,5]       [,6]
#> [1,] 0.01987302 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000
#> [2,] 0.00000000 0.03679889 0.00000000 0.00000000 0.00000000 0.00000000
#> [3,] 0.00000000 0.00000000 0.02477895 0.00000000 0.00000000 0.00000000
#> [4,] 0.00000000 0.00000000 0.00000000 0.01689664 0.00000000 0.00000000
#> [5,] 0.00000000 0.00000000 0.00000000 0.00000000 0.01540632 0.00000000
#> [6,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.02225544
#> [7,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000
#> [8,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000
#>           [,7]      [,8]
#> [1,] 0.0000000 0.0000000
#> [2,] 0.0000000 0.0000000
#> [3,] 0.0000000 0.0000000
#> [4,] 0.0000000 0.0000000
#> [5,] 0.0000000 0.0000000
#> [6,] 0.0000000 0.0000000
#> [7,] 0.0260845 0.0000000
#> [8,] 0.0000000 0.0186575

decomp <- eigen(C)
E <- diag(decomp$values)
R <- decomp$vectors

all(round(C, 2) == round(R %*% E %*% t(R), 2))
#> [1] TRUE

t <- dim(df)[1]
n <- dim(df)[2]

e_thresh <- 1 + n / t + 2 * sqrt(n / t)
e_thresh <- 0.55

e <- diag(E)
e[e < e_thresh] = 0
E_robust <- diag(e)

C_robust <- R %*% E_robust %*% t(R)
diag(C_robust) <- 1
C_robust
#>           [,1]       [,2]      [,3]       [,4]      [,5]      [,6]      [,7]
#> [1,] 1.0000000 0.56822109 0.4885112 0.46738138 0.2666386 0.4777194 0.3369550
#> [2,] 0.5682211 1.00000000 0.3406198 0.06400039 0.2825352 0.1386562 0.1962027
#> [3,] 0.4885112 0.34061984 1.0000000 0.51824966 0.5755952 0.4511759 0.5693106
#> [4,] 0.4673814 0.06400039 0.5182497 1.00000000 0.3734853 0.2584428 0.2902524
#> [5,] 0.2666386 0.28253519 0.5755952 0.37348529 1.0000000 0.4656507 0.3521406
#> [6,] 0.4777194 0.13865621 0.4511759 0.25844283 0.4656507 1.0000000 0.3658862
#> [7,] 0.3369550 0.19620271 0.5693106 0.29025245 0.3521406 0.3658862 1.0000000
#> [8,] 0.2959622 0.20893189 0.3607661 0.26384470 0.3364438 0.2821225 0.2775334
#>           [,8]
#> [1,] 0.2959622
#> [2,] 0.2089319
#> [3,] 0.3607661
#> [4,] 0.2638447
#> [5,] 0.3364438
#> [6,] 0.2821225
#> [7,] 0.2775334
#> [8,] 1.0000000

V_robust <- S %*% C_robust %*% S
V_robust
#>              [,1]         [,2]         [,3]         [,4]         [,5]
#> [1,] 3.949370e-04 0.0004155430 0.0002405589 1.569407e-04 8.163678e-05
#> [2,] 4.155430e-04 0.0013541583 0.0003105900 3.979400e-05 1.601792e-04
#> [3,] 2.405589e-04 0.0003105900 0.0006139963 2.169812e-04 2.197349e-04
#> [4,] 1.569407e-04 0.0000397940 0.0002169812 2.854963e-04 9.722382e-05
#> [5,] 8.163678e-05 0.0001601792 0.0002197349 9.722382e-05 2.373547e-04
#> [6,] 2.112871e-04 0.0001135560 0.0002488083 9.718537e-05 1.596597e-04
#> [7,] 1.746700e-04 0.0001883312 0.0003679720 1.279260e-04 1.415134e-04
#> [8,] 1.097371e-04 0.0001434474 0.0001667869 8.317676e-05 9.670853e-05
#>              [,6]         [,7]         [,8]
#> [1,] 2.112871e-04 0.0001746700 1.097371e-04
#> [2,] 1.135560e-04 0.0001883312 1.434474e-04
#> [3,] 2.488083e-04 0.0003679720 1.667869e-04
#> [4,] 9.718537e-05 0.0001279260 8.317676e-05
#> [5,] 1.596597e-04 0.0001415134 9.670853e-05
#> [6,] 4.953045e-04 0.0002124050 1.171459e-04
#> [7,] 2.124050e-04 0.0006804013 1.350676e-04
#> [8,] 1.171459e-04 0.0001350676 3.481021e-04

V <- cov(df)

S_inv <- diag(1 / sqrt(diag(V)))
all(round(S_inv %*% V %*% S_inv, 2) == round(cor(df), 2))
#> [1] TRUE
```
